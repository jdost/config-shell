# Variables

# PIP
export PIP_DOWNLOAD_CACHE=$XDG_CACHE_HOME/pip
export PIP_CONFIG_FILE=$XDG_CONFIG_HOME/pip.conf
# VIRTUALENV
export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2
export WORKON_HOME=$HOME/.local/virtualenvs
export VIRTUALENVWRAPPER_HOOK_DIR=$HOME/.local/virtualenvs
export VIRTUALENVWRAPPER_LOG_DIR=$HOME/.local/virtualenvs
# ACK
export ACKRC=$XDG_CONFIG_HOME/ackrc
# NPM
export NPM_CONFIG_USERCONFIG=$XDG_CONFIG_HOME/npmrc
# INPUTRC
export INPUTRC=$XDG_CONFIG_HOME/inputrc
# GPG/PASSWORD STORE
export GNUPGHOME=$HOME/.local/gpg
export PASSWORD_STORE_DIR=$HOME/.local/password_store
# LESS
export LESSHISTSIZE=0
# GREP
if [[ -e "$(which rg 2>/dev/null)" ]]; then
   # replace grep with ripgrep if installed
   alias grep='rg'
else
   alias grep='grep --color=auto'
fi
# LS
if [[ -e "$(which exa 2>/dev/null)" ]]; then
   # replace ls with exa if installed
   alias ls=' exa -l'
else
   alias ls='ls -F'
fi
# DIFF
if [[ -e "$(which colordiff 2>/dev/null)" ]]; then
   # replace diff with colordiff if installed
   alias diff='colordiff'
fi
# WEECHAT
if [[ -e "$(which weechat 2>/dev/null)" ]]; then
   alias weechat='weechat-curses -d $XDG_CONFIG_HOME/weechat'
   alias irc='weechat'
fi
# MPD
if [[ -e "$(which ncmpcpp 2>/dev/null)" ]]; then
   alias ncmpcpp='ncmpcpp -c $XDG_CONFIG_HOME/ncmpcpp/config'
fi

# Aliases {{{
if [[ -e "$(which term_info 2>/dev/null)" ]]; then
   # Add the header when clearing if the header script is defined
   alias clear='clear;term_info'
fi
alias df="df -h"
alias du="du -h"
alias ping='ping -c 5'
# }}}

# GPG {{{
if [[ -e "$(which gpg-agent 2>/dev/null)" ]] ; then
   if [ ! gpg-connect-agent --quiet /bye > /dev/null 2> /dev/null ]; then
      local GPG_AGENT_ENV=$GNUPGHOME/gpg-agent.env
      eval $(gpg-agent --daemon --enable-ssh-support --quiet --write-env-file $GPG_AGENT_ENV)
      chmod 600 $GPG_AGENT_ENV
      export GPG_AGENT_INFO
   fi
fi # }}}

# SSH-Agent startup {{{
if [[ -z "$SSH_AUTH_SOCK" ]]; then
   if [[ -e "$(which gpg-agent 2>/dev/null)" ]]; then
      #export SSH_AUTH_SOCK="${XDG_RUNTIME_DIR}/gnupg/S.gpg-agent.ssh"
      export SSH_AUTH_SOCK="$(gpgconf --list-dirs agent-ssh-socket)"
      gpgconf --launch gpg-agent
      export GPG_TTY=$(tty)
      gpg-connect-agent updatestartuptty /bye > /dev/null
   elif [[ -e "$(which ssh-agent 2>/dev/null)" ]]; then
      eval `ssh-agent -s` && ssh-add
      # symlink and switch to the symlink to keep a standard auth sock definition
      [[ -h "$HOME/.ssh/auth.sock" ]] && rm "$HOME/.ssh/auth.sock"
      ln -s $SSH_AUTH_SOCK "$HOME/.ssh/auth.sock"
      export SSH_AUTH_SOCK="$HOME/.ssh/auth.sock"
   fi
elif [[ -e "$(which gpg-agent 2>/dev/null)" ]]; then
   # Correct GPG settings even if there is a defined auth sock
   export GPG_TTY=$(tty)
   gpg-connect-agent updatestartuptty /bye > /dev/null
else
   # We have an auth sock defined, lets check if it works
   if ssh-add -l &>/dev/null; then
      # The auth sock works, don't mess with it...
   elif SSH_AUTH_SOCK="$HOME/.ssh/auth.sock" ssh-add -l &>/dev/null; then
      # The defined one doesn't work, but the linked one does, switch to it
      export SSH_AUTH_SOCK="$HOME/.ssh/auth.sock"
   else
      export SSH_AUTH_SOCK=""
      rm "$HOME/.ssh/auth.sock"
   fi
fi # }}}

# vim: ft=zsh:foldmethod=marker
